---
title: "Statistical Analysis"
output: html_document
---

<style>
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    background-color: #337ab7;
}

.navbar-default .navbar-collapse, .navbar-default .navbar-form {
background-color: #337ab7;
}

.navbar-default {
background-color: #337ab7;
}

.navbar-default .navbar-nav>li>a {
color: white;
font-weight: bold;
}

.navbar-default .navbar-brand {
color: white;
font-weight: bold;
}

</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(message = FALSE)
```

```{r, loading_packages}
library(nnet)
library(tidyverse)
```

```{r, data_import}
sex_drug_weapons = readRDS(file = "./datasets/sex_drug_weapons.rds")
```

For our formal statistical analysis, we wanted to examine the association between sex-related, drug-related, and weapons-related felonies and boroughs. We chose to look at this because the exploratory analyses suggested that the rates of these felonies differed, depending on the borough.

<br>

### Model Statement for the Multinomial Logistic Regression Model

$$ln (P( crimegroup = drug-related)/P(crime group = sex-related)) = \beta_10 + \beta_11(Bronx) + \beta_12(Brooklyn) + \beta_13(Queens) + \beta_14(Staten Island)$$

$$ln(P(crimegroup = weapon-related)/P(crime group = sex-related)) = \beta_20 + \beta_21(Bronx) + \beta_22(Brooklyn) + \beta_23(Queens) + \beta_24(Staten Island)$$

Drug-related group was chosen as reference group among the 3 types of felonies because it is the least serious of the 3 crime groups. For the boroughs, Manhattan was chosen as the reference group because it is widely thought to be the borough with least crime.

```{r}
### Making Drug-related Felonies and Manhattan  - Reference Groups
sex_drug_weapons = sex_drug_weapons %>%
  mutate(crime_group = forcats::fct_relevel(crime_group, "Drug-Related"),
         boro_nm = forcats::fct_relevel(boro_nm, "manhattan"))

```

<br>

### Tabulation

We create a data table to organize the rates of drug-related, sex-related, and weapons-related felonies.
```{r, felonies_boroughs}
with(sex_drug_weapons, table(boro_nm, crime_group)) %>%
  knitr::kable()
```

```{r, results = "hide"}
fit = multinom(crime_group ~ boro_nm, data = sex_drug_weapons) %>% broom::tidy() %>% 
  mutate( OR = exp(estimate))
```

```{r}
fit %>% knitr::kable()

```

```{r}

ggplot(fit, aes(x = term, y = OR)) +
  geom_segment( aes(x = term, xend = term, y = 0, yend = OR), color = "grey") +
  geom_point(color = "orange", size = 3) + facet_grid(~ y.level) +
  theme_light() +
  theme(axis.text.x = element_text(angle = 80, hjust = 1, size = 8),
    panel.grid.major.x = element_blank(),
    panel.border = element_blank(),
    axis.ticks.x = element_blank()) +
  labs(x = "Borough",
       y = "Odds Ratio")

```

### Interpretation

The odds of sex-related crimes in manhattan is 1.79. 
The odds  of sex related vs. drug-related crimes will increase by 1.71 if moving from Manhattan to Bronx. 
The odds of sex related vs. drug-related crimes will increase by 2.3684 if moving from Manhattan to Brooklyn.
The odds of sex related vs. drug-related crimes will increase by 3.06 if moving from Manhattan to Queens.
The odds of sex related vs. drug-related crimes will increase by 2.106 if moving from Manhattan to Staten Island. 

The odds of weapon related crimes in manhattan is 2.7. 

The odds of weapon related vs. drug related crimes will increase by 2.064 if moving from Manhattan to Bronx.
The odds of weapon related vs drug related crimes will increase by 4.14 if moving from Manhattan to Brooklyn. 
The odds of weapon related vs drug related crimes will increase by 4.22 if moving from Manhattan to Queens. 
The odds of weapon related vs drug related crimes will increase by 2.62 if moving from Manhattan to Staten Island. 


```{r, eval = FALSE}
x = sex_drug_weapons %>% filter(vic_race != "unknown") %>% filter(crime_group != "Sex-Related") %>% 
  mutate(race = if_else(vic_race == "white", "white", "minority")) %>% 
  mutate(race = as.factor(race),
         crime_group = as.factor(crime_group))

glm(crime_group ~ race, family = binomial(), data = x) %>% broom::tidy() %>% 
  mutate( OR = exp(estimate)) %>% knitr::kable()

multinom(crime_group ~ race, data = x) %>% broom::tidy() %>% 
  mutate(OR = exp(estimate)) %>% knitr::kable(digits = 4)
```

