---
title: "NYC Crime Data"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r}
library(tidyverse)
library(RSocrata)
library(lubridate)
```

### Accessing the data. 

The data was accessed through an API on 17th November, 2018.

Click [here](https://dev.socrata.com/consumers/getting-started.html) to read more about the API. 

```{r, eval = FALSE}
## Install the required package with:
## install.packages("RSocrata)

nyc_crime = read.socrata(
  "https://data.cityofnewyork.us/resource/9s4h-37hy.json",
  app_token = "jK8jo5IhF6gBPFqZ1va8ITny0",
  email     = "yakubuamin@ymail.com",
  password  = "daTA@12345" )

saveRDS(nyc_crime, file = "data/nyc_crime.rds")
```


Click [here](https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Historic/qgea-i56i) for an overview of the dataset. 

### Subsetting 

Since we are interested in looking at incidence i.e. when the crime happen, we will filter out variables without exact date of occurrence. There were 655 out of 6,036,805 observations without exact date of crime occurrence. Also we are interested in 2017, 2016, 2015, 2014 and 2013 so we will take out those years. 

```{r, eval = FALSE}
# This code was used to retrieve and assess the observations with missing date of crime occurrence

crime_missing_cp = nyc_crime %>% 
  filter(is.na(cmplnt_fr_dt))

#Cleaning and subsetting the data

nyc_felony_misdemeanor = nyc_crime %>% 
  janitor::clean_names() %>% 
  filter(!is.na(cmplnt_fr_dt)) %>%
  mutate(year = year(cmplnt_fr_dt))%>%
  mutate_if(is.character, tolower) %>% 
  filter(year %in% 2014:2017) %>% 
  filter(law_cat_cd == "felony" | law_cat_cd == "misdemeanor") %>% 
  select(- station_name, - transit_district, - hadevelopt, - patrol_boro, - housing_psa, - juris_desc)

saveRDS(nyc_felony_misdemeanor, file = "datasets/nyc_felony_misdemeanor.rds")

```

To use our data, use the following code

```{r, eval = FALSE}

readRDS(file = "datafiles/nyc_felony_misdemeanor.rds")
```

